// Auto-detect API URL based on current location
const getApiUrl = () => {
    const currentHost = window.location.hostname;
    const currentPort = window.location.port;
    
    // If running on Render
    if (currentHost.includes('onrender.com') || currentHost === 'rf-automation-1.onrender.com') {
        return '/api/links'; // Same origin when served from backend
    }
    
    // If local development with backend on port 3000
    if (currentHost === 'localhost' || currentHost === '127.0.0.1') {
        // Check if frontend is served from backend or separately
        if (currentPort === '3000' || currentPort === '') {
            return '/api/links'; // Same origin
        } else {
            return 'http://localhost:3000/api/links'; // Cross-origin
        }
    }
    
    // Default
    return '/api/links';
};

const API_URL = getApiUrl();
console.log('API URL:', API_URL);

async function fetchData() {
    const app = document.getElementById('app');
    app.innerHTML = `
        <div class="loading">
            <div>üîç Fetching Radio Links...</div>
            <small>Connecting to: ${API_URL}</small>
        </div>
    `;

    try {
        console.log('Fetching data from:', API_URL);
        const response = await fetch(API_URL, {
            headers: {
                'Accept': 'application/json',
                'Cache-Control': 'no-cache'
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('Data received:', Object.keys(data).length, 'POP groups');
        renderUI(data);
        
    } catch (error) {
        console.error('Fetch error:', error);
        app.innerHTML = `
            <div style="background: var(--card); padding: 30px; border-radius: 8px; text-align: center; border: 1px solid var(--danger);">
                <h3 style="color: var(--danger);">‚ö†Ô∏è Connection Error</h3>
                <p style="color: var(--sub);">${error.message}</p>
                <p style="color: var(--sub); font-size: 0.9rem; margin-top: 20px;">
                    Backend URL: ${API_URL}<br>
                    Make sure the backend server is running.
                </p>
                <button onclick="fetchData()" class="header-btn" style="margin-top: 20px;">üîÑ Retry</button>
            </div>
        `;
    }
}
